{% requireAdmin %}
{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set fullPageForm = true %}
{% set title = plugin.name %}
{% set docTitle = title ~ ' - ' ~ "Plugins"|t('app') %}

{% set crumbs = [
    { label: "Settings"|t('app'), url: url('settings') },
    { label: "Plugins"|t('app'), url: url('settings/plugins') }
] %}

{% set tabs = {
    main: {
        label: 'Main settings'|t('activity'),
        url: '#settings-main'
    },
    elements: {
        label: 'Elements'|t('activity'),
        url: '#settings-elements'
    },
    config: {
        label: 'Config'|t('activity'),
        url: '#settings-config'
    },
    settings: {
        label: 'Settings'|t('activity'),
        url: '#settings-settings'
    }
} %}

{% block content %}
    {{ actionInput('plugins/save-plugin-settings') }}
    {{ hiddenInput('pluginHandle', 'activity') }}
    {{ redirectInput('settings') }}

    {% namespace 'settings' %}
    <div class="tab-content" id="main">
        {{
            forms.lightswitchField({
                label: 'Ignore activity for console requests'|t('activity'),
                name: 'ignoreConsoleRequests',
                on: settings.ignoreConsoleRequests,
                fieldClass: 'first'
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Ignore activity for cp requests'|t('activity'),
                name: 'ignoreCpRequests',
                on: settings.ignoreCpRequests,
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Ignore activity for site requests'|t('activity'),
                name: 'ignoreSiteRequests',
                on: settings.ignoreSiteRequests,
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Ignore activity when Yaml changes are being applied'|t('activity'),
                name: 'ignoreApplyingYaml',
                on: settings.ignoreApplyingYaml,
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Deleting a user will delete all its activity'|t('activity'),
                name: 'deleteLogsWithUser',
                on: settings.deleteLogsWithUser
            })
        }}

        {{
            forms.textField({
                label: 'Automatically delete activity older than'|t('activity'),
                instructions: 'No value means activity will never be deleted'|t('activity'),
                value: settings.autoDeleteLogsThreshold,
                name: 'autoDeleteLogsThreshold',
                type: 'number',
                min: 1,
                unit: 'days'|t('activity')
            })
        }}

        <input type="hidden" name="ignoreTypes" value="">
        {{
            forms.checkboxSelectField({
                label: 'Ignore the following activity:'|t('activity'),
                name: 'ignoreTypes',
                options: types,
                values: settings.ignoreTypes
            })
        }}
    </div>

    <div class="tab-content hidden" id="elements">
        <p>{{ 'These settings apply to elements (users, entries, globals, categories)'|t('activity') }}</p>
        {{
            forms.lightswitchField({
                label: 'Ignore activity when elements are resaved'|t('activity'),
                name: 'ignoreResave',
                on: settings.ignoreResave,
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Ignore activity when elements slugs and uris are updated'|t('activity'),
                name: 'ignoreUpdateSlugs',
                on: settings.ignoreUpdateSlugs
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Ignore activity when elements are propagated to other sites'|t('activity'),
                name: 'ignorePropagate',
                on: settings.ignorePropagate,
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Track changes made in elements'|t('activity'),
                name: 'trackElementFieldsChanges',
                on: settings.trackElementFieldsChanges
            })
        }}

        {{
            forms.lightswitchField({
                label: 'Ignore elements activity when no changes have been done'|t('activity'),
                instructions: "This has no effect if element changes aren't tracked."|t('activity'),
                name: 'ignoreNoElementChanges',
                on: settings.ignoreNoElementChanges
            })
        }}
    </div>

    <div class="tab-content hidden" id="config">
        <p>{{ 'These settings apply to all cp config models (category groups, sections, volumes etc)'|t('activity') }}</p>
        {{
            forms.lightswitchField({
                label: 'Track changes made in config'|t('activity'),
                name: 'trackConfigFieldsChanges',
                on: settings.trackConfigFieldsChanges
            })
        }}
        {{
            forms.lightswitchField({
                label: 'Ignore config activity when no changes have been done'|t('activity'),
                instructions: "This has no effect if config changes aren't tracked."|t('activity'),
                name: 'ignoreNoConfigChanges',
                warning: "This will also ignore activity when something has been changed on a field that is not tracked by the system"|t('activity'),
                on: settings.ignoreNoConfigChanges
            })
        }}
    </div>

    <div class="tab-content hidden" id="settings">
        <p>{{ 'These settings apply to yaml settings (general, assets, users etc)'|t('activity') }}</p>
        {{
            forms.lightswitchField({
                label: 'Ignore settings activity when no changes have been done'|t('activity'),
                name: 'ignoreNoSettingsChanges',
                warning: "This will also ignore activity when something has been changed on a field that is not tracked by the system"|t('activity'),
                on: settings.ignoreNoSettingsChanges
            })
        }}
    </div>
    {% endnamespace %}
{% endblock %}