{% macro fromValue(data) %}
    <code>{{ (data.ff ?? data.f)|prettyPrint }}</code>
{% endmacro %}

{% macro toValue(data) %}
    <code>{{ (data.tf ?? data.t)|prettyPrint }}</code>
{% endmacro %}

{% macro fieldLabel(name, log) %}
    {% set label = log.getFieldLabel(name) %}
    {% if label %}
        {{ label }}
    {% else %}
        <code>{{ name }}</code>
    {% endif %}
{% endmacro %}

{% macro settingLabel(name, log) %}
    {% set label = log.getSettingLabel(name) %}
    {% if label %}
        {{ label }}
    {% else %}
        <code>{{ name }}</code>
    {% endif %}
{% endmacro %}

{% macro elementValue(value) %}
    {% if value is iterable %}
        {% set value = value|join(', ') %}
    {% else %}
        {% set value = value|prettyPrint %}
    {% endif %}
    <code>{{ value }}</code>
{% endmacro %}

{% macro elementToValue(data) %}
    {{ _self.elementValue(data.tf ?? data.t) }}
{% endmacro %}

{% macro elementFromValue(data) %}
    {{ _self.elementValue(data.ff ?? data.f) }}
{% endmacro %}

{% macro elementField(field) %}
    {% set template = handlerTemplate(field.handler) %}
    {% if template %}
        {% include template %}
    {% else %}
        {% set hasFrom = 'f' in field.data|keys %}
        {% set hasTo = 't' in field.data|keys %}
        <li>
            {% if hasFrom and hasTo %}
                {{ "Field {field} was changed from {from} to {to}"|t('activity', {
                    field: field.data.name,
                    from: _self.elementFromValue(field.data),
                    to: _self.elementToValue(field.data)
                })|raw }}
            {% elseif hasTo %}
                {{ "Field {field} was set to {to}"|t('activity', {
                    field: field.data.name,
                    to: _self.elementToValue(field.data)
                })|raw }}
            {% elseif hasFrom %}
                {{ "Field {field} value ({from}) was removed"|t('activity', {
                    field: field.data.name,
                    from: _self.elementFromValue(field.data)
                })|raw }}
            {% endif %}
        </li>
    {% endif %}
{% endmacro %}

{% macro configField(field, log) %}
    {% set template = handlerTemplate(field.handler) %}
    {% if template %}
        {% include template %}
    {% else %}
        {% set hasFrom = 'f' in field.data|keys %}
        {% set hasTo = 't' in field.data|keys %}
        <li>
            {% if hasFrom and hasTo %}
                {% if field.data.f is same as(true) and field.data.t is same as(false) %}
                    {{ "{field} was unchecked"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                    })|raw }}
                {% elseif field.data.f is same as(false) and field.data.t is same as(true) %}
                    {{ "{field} was checked"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                    })|raw }}
                {% else %}
                    {{ "{field} was changed from {from} to {to}"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                        from: _self.fromValue(field.data),
                        to: _self.toValue(field.data)
                    })|raw }}
                {% endif %}
            {% elseif hasTo %}
                {% if field.data.t is same as(false) %}
                    {{ "{field} was unchecked"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                    })|raw }}
                {% elseif field.data.t is same as(true) %}
                    {{ "{field} was checked"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                    })|raw }}
                {% else %}
                    {{ "{field} was set to {to}"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                        to: _self.toValue(field.data)
                    })|raw }}
                {% endif %}
            {% elseif hasFrom %}
                {% if field.data.f is same as(false) %}
                    {{ "{field} was unchecked"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                    })|raw }}
                {% elseif field.data.f is same as(true) %}
                    {{ "{field} was checked"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                    })|raw }}
                {% else %}
                    {{ "{field} value ({from}) was removed"|t('activity', {
                        field: _self.fieldLabel(field.name, log),
                        from: _self.fromValue(field.data)
                    })|raw }}
                {% endif %}
            {% else %}
                {{ "{field} was changed"|t('activity', {
                    field: _self.fieldLabel(field.name, log)
                })|raw }}
            {% endif %}
        </li>
    {% endif %}
{% endmacro %}